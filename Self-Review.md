## Self-review

### 1. Вводная часть

Не устану говорить, что тимлид Лёша нуууу мёёёёёёёёёёд, особенно после встречи на корпоративе)

### 2. Задачи и достижения
#### 2.1. Задачи и достижения из планов на будущее с прошлого ревью

Тут я хочу перечислить то, что было в прошлом ревью и что я из этого достиг и что не смог:

- 2.1.1 Итоги пентеста\
	После 2 пентестов получили 2 пачки уязвимостей, которые нужно закрыть до конца года пока успеваем - большая часть уязвимостей осталась на разработчиках.

- 2.1.2 Развитие FreeIPA:
	- Настроить интеграцию я базой 1С/Slack/HR box для автоматического отключения учеток сотрудников - пока ждем перенос базы 1С в наше облако, хочу закрыть эту задачку к следующему ревью, но перенос базы 1С не зависит от нас, увы задачу не сделал;
  
	- Настроть больше интеграций через LDAP в FreeIPA, планировали 3, а  настроил для 7, добавилась интеграция для Sctructurizer, Grafana, PfSense, PostgreSQL (only dev, жду новый кластер от Макса Копченова для prod), Wazuh, HashiCorp Vault, Sonatype Nexus. 

	- Проверяем введённый пароль пользователем по словарю утекших паролей на ~50 ГБ, плюс попытался перебрать текущие hash-пароли с помощью словаря rockyou.txt - слабых паролей не выявил. Задачка была мега интересная для меня, я написал свое собственное решение на Python - оно оказалось очень медленным, и я решил первый раз в жизни попробовать написать что-то на Go, познакомился с Go рутинами и дело пошло бодрее, с 1 тыс. hash/секунду я прыгнул до 10 тыс. hash/секунду, но для 100 пользователей на тот момент это было очень медленно и я стал изучать hashcat, и как мы можем брутить hash на видеокарте, в итоге на RTX 2060 Super удалось добиться скорости 3.2 миллиона hash/секунду и проверить все пароли за приемлемое время))).

	- Перевел 100% Linux серверов на доменную аутентификацию и заблокировал локальные учетки на всех серверах, но оставил исключение для 12.0.0.0/24 (привилегированный VPN) на возможный факап, для его быстрого предотвращения.

- 2.1.3 Ansible\
	Продолжаю пилить IaC, использовать best practise для Ansible, доработал ansible playbook для раскатки ipset + сейчас в разработке playbook для автоматической подготовки Nebula Lighthouse и Nebula клиентов + использую для автоматизации Nebula новые для себя инструменты HashiCorp Vault и Jenkins.

- 2.1.4 Wazuh\
	С джуном настроили подробное логирование системы доменного доступа FreeIPA, реализовали сценарии, которые будем считать инцидентами, которые нужно расследовать, научил джуна писать декодеры и правила для SIEM самостоятельно.
	Расширили модуль Active Response, теперь мы блокируем больше вариантов атак автоматически, были ложно-положительные сработки, когда разработчики выполняли поиск в Gitea, их подавили, больше проблем не наблюдалось. 

- 2.1.5. Инструкции и делегирование\
	Написал инструкции для администрирования FreeIPA, сделал стандартизированный нейминг учетных записей и предусмотрел конфликт имен, например у нас был Denis Matveev и есть Dmitriy Matveev, оба должны получить логин d.matveev, кто был ранее зарегистрирован - получит логин d.matveev, последующи(й/е) d2.matveev и т.д.
	Также стандартизировал названия групп пользователей, правил разграничения доступа к серверам, службам и sudo-командам на серверах, чтобы поддерживался порядок и идемпотентность системы.
	Написал инструкции для администрирования и траблшутинга FreeIPA/xRDP, передал FreeIPA в руки DevOps-инженеров.

- 2.1.6 Джун в platforma-security\
	Попробовал себя в качестве ментора для нового сотрудника команды platforma-security, активно передаю свои знания и опыт, Артем быстро вкатился в работу и у него хорошо получается решать те задачки, которые планируем для него, передаю свою опыт и знания накопленные за это время + еще неожиданно для себя часто стал общаться с Ильей Зверевым и передавать часть своих знаний по инфраструктуре и написанию Python скриптов/работы с HashiCorp Vault/LDAP ему)

#### 2.2. Другие задачи и достижения 

- 2.2.1 Помощь DevOps инженерам\
	Обновил под наблюдением Вовы две наши Grafana на новые версии, для Grafana со Status Page переписал метод запуска с императивного на декларативный.
	Помогаю DevOps инженерам в #devs-infrastructure по возможности + написал инструкции для самостоятельного траблшутинга типичных проблем, чтобы мы могли отбиваться от лички/типичных проблем ссылкой и тратить меньше времени на рутинные проблемы.
	Участвую в закрытии уязвимостей найденных после 2 пентестов, часть задач в команде с DevOps инженерами, где требуется мое участие/часть самостоятельно.
	Сделал L2TP IPSec туннель до GPN сети Servers.ru из Yandex Cloud, это облегчает выполнение задач, где требуется связь по сети между Yandex Cloud и GPN сетью Servers.ru, + позволило перенести сервера xRDP на более дешевые и гибкие по настройке ресурсов сервера Yandex Cloud, для xRDP не совсем подходят тарифы предоставляемые Servers.ru 

- 2.3.2 Перенос xRDP сервера на Yandex Cloud\
	Перенес сервер с Servers.ru на Yandex Cloud, развернул второй xRDP сервер, настроил синхронизацию домашних каталогов пользователей в режиме реального времени на двух серверах, что позволило "кластеризовать" xRDP сервера и сделать подобие "Фермы Терминальных серверов" как решение для Windows. Нагрузка балансируется через HaProxy, первый раз использовал HaProxy - изучил для себя новый инструмент и написал свой агент с healthcheck'ом, в зависимости от свободной ОЗУ агент отдает вес сервера для балансировки, чем больше свободно ОЗУ - тем больше подключений принимает сервер. Для пользователя каждый раз вход происходит по одному и тому же доменному имени, им не нужно выбирать сервер/понимать где сейчас "свободнее".
	Если раньше мы не могли гибко расширять ресурсы xRDP сервера - сейчас эта проблема решена, сервера будут легко масштабироваться, если текущих ресурсов будет не хватать.

- 2.2.3 Развернул прокси-сервер для доступа в Интернет через прокси\
	Прокси-сервер позволит выпустить все сервера в Интернет через единую точку выхода + контролировать список доступных доменов, в идеале хотели добавить аутентификацию на прокси-сервер, но прозрачное проксирование и авматотическая аутентификация доменных юзеров реализуются только на Windows с помощью Active Directory Domain Controller и его политик.
	На самом прокси-сервере уже установили IDS для анализа трафика, проходящего через него, пока что работает в режиме выявления атак, без блокировок. 

- 2.2.4 FreeIPA\
	Теперь 2 сервера FreeIPA доступны под 1 доменным именем `freeipa.sw.local`, с помощью HaProxy балансируется нагрузка на 2 сервера по схеме roundrobin, задача выглядела изян, но был подводный камень с тем что FreeIPA строго требует обращение к себе по доменному имени. Для этого настроил подмену заголовков Host, Referer и Location в зависимости от того на какой сервер падает балансировка, получился интересный ресерч и реализация. 

- 2.2.5 Матрица доступов\
	Пока что отказались от полноценной матрицы доступов и решили для экономии ресурсов сделал "примитивную" матрицу доступов, которая наглядно показывает стандартные права для сотрудников разных должностей, эта табличка используется в основе скрипта для автоматизации выдачи доступа в FreeIPA, что сейчас пилится совместно с Ильей Зверевым.

- 2.2.6 Nebula и overlay-сети\
	Прокачал себя в overlay-сетях, изучил принцип их работы, пощупал разные решения и остановился на Nebula от Slack. Задача очень объемная и требует долгого теста на dev-окружениях и плавный ввод prod серверов в случае успешного теста на dev и stage средах. 
	Сейчас у нас проблемы с сетевой инфраструктурой из-за Servers.ru, которые не предоставляют возможности управлять сетью в облаке, из-за этого не получается явно разбить сеть на подсети (dev/prod/stage/ops и т.д.) для нормальных ограничений. 
	Nebula позволит решить проблему с разграничением сетевой доступности и свяжет разные зоны Servers.ru и Yandex Cloud в единую сеть.
	Уже спроектировал и согласовал схему сред в Nebula сети, безопасное хранение ключа корневого сертификата Nebula сети и Jenkins сборку для автоматического создания сертификатов и инвентаризации сети.

- 2.2.7 Jenkins\
	Изучил для себя новый инструмент и запилил пару сборок:
	Первая для автоматической генерации актуального SSH конфига через методы API Servers.ru и Yandex Cloud для подключения к серверам
	Вторая для Nebula - генерация сертификатов и автоматическая инвентаризация сети
	т.к. это больше задача по DevOps - отдаю приоритет security задачам, в оставшееся время пилю Nebula.

### 3. Зоны роста

- Прошлый раз я писал что хочу улучшить понимание облачной инфраструктуры - думаю я успешно прокачался в этом, т.к. передавал свои знания по инфре Илье Звереву/Саше Харалгину в части сетевой доступности облаков/исторических моментов в нашей инфре.

- Сейчас явно зону роста увидеть/найти не могу, может быть стоить попробовать себя в планировании задач не только на спринт для себя и Артема, а в целях на PI/годовых целях команды и если у нас планируется найм в команду Security - поучаствовать в нем в качестве технического интервьюера.

### 4. Планы на будущее

Хочу разделить этот пункт на блоки:

- 4.1 Jenkins\
	Если будут задачи с Jenkins - будет славно еще раз воспользоваться этим инструментом  и запилить сборки, мне понравилось.

- 4.2 Развивать FreeIPA
	- 4.2.1 Настроить интеграцию с базой 1С, когда базу перенесут к нам в облако.

	- 4.2.2 Продолжить использовать FreeIPA для доменного доступа в Web-приложения по типу Gitea/Grafana и т.д., если у Web-приложения есть такая возможность.

	- 4.2.3 Запилить доменную аутентификацию на VPN серверах, сейчас если человек увольняется - можно забыть отозвать сертификат/заблокировать конфигурацию .ovpn пользователя или вообще не найти ее, интеграция с FreeIPA по LDAP позволит заблокировать пользователя по учетке в FreeIPA, а если настроится интеграция с 1С - полностью автоматизировать этот процесс.

- 4.3 Ansible\
	Продолжать использовать Ansible и брать его best practice, если будут какие-то задачи, где можно применить автоматизацию Ansible - это было в прошлом self-review, оставляем, автоматизация это круто

- 4.4 Менторство\
	Я попробовал себя в роли ментора - мне понравилось, в будущем можно забрать еще одного менти, если будет возможность

- 4.5 Wazuh\
	Продолжать развивать SIEM, добавлять новые правила, декодеры и сценарии для Wazuh, использовать дополнительные модули предоставляемые SIEM

- 4.6. Анализаторы кода\
	Может быть внедрить SAST/DAST для анализа кода на уязвимости перед релизом

- 4.7 Регламенты\
	Леша говорил, что для более успешного прохождения оценки security компании по разным методологиям нам не хватает регламентов, в планах поучаствовать в написании регламентов, главное чтобы это не скатилось в пейпер секурити.

- 4.8 Прокси и развитие закрытого контура инфраструктуры\
	Сейчас у нас через прокси в Интернет ходят xRDP сервера и RC, в идеале довести инфраструктуру до полного доступа в Интернет только через прокси-сервер + использовать Sonatype Nexus для хранения apt-пакетов серверов, это позволит сделать собственное зеркало apt-пакетов для Linux дистрибутивов, в следствие чего отпадает необходимость каждому серверу ходить в Интернет, нужные пакеты и ресурсы для работы будут доступны внутри локальной сети.  


Блок с планами сильно зависит от годовых целей и целей на первый - второй PI в 2025 году, которые поставит Леша, скорее всего планы могут скорректироваться. 
